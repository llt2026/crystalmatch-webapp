/**
 * 天干地支与五行关系映射模块
 */

// 天干类型
export type TianGan = '甲' | '乙' | '丙' | '丁' | '戊' | '己' | '庚' | '辛' | '壬' | '癸';

// 地支类型
export type DiZhi = '子' | '丑' | '寅' | '卯' | '辰' | '巳' | '午' | '未' | '申' | '酉' | '戌' | '亥';

// 五行元素类型
export type Elem = 'wood' | 'fire' | 'earth' | 'metal' | 'water';

// 五行向量类型
export interface FiveElementVector {
  wood: number;
  fire: number;
  earth: number;
  metal: number;
  water: number;
}

/**
 * 天干五行对应关系
 */
export const tianGanElement: Record<TianGan, Elem> = {
  '甲': 'wood', '乙': 'wood',
  '丙': 'fire', '丁': 'fire',
  '戊': 'earth', '己': 'earth',
  '庚': 'metal', '辛': 'metal',
  '壬': 'water', '癸': 'water'
};

/**
 * 地支本气五行对应关系
 */
export const diZhiMainElement: Record<DiZhi, Elem> = {
  '子': 'water', '丑': 'earth',
  '寅': 'wood', '卯': 'wood',
  '辰': 'earth', '巳': 'fire',
  '午': 'fire', '未': 'earth',
  '申': 'metal', '酉': 'metal',
  '戌': 'earth', '亥': 'water'
};

/**
 * 地支藏干关系及权重
 * 每个地支包含的天干及其权重
 */
export const diZhiHiddenGan: Record<DiZhi, Record<TianGan, number>> = {
  // 子水：癸水100%
  '子': { '癸': 1.0, '甲': 0, '乙': 0, '丙': 0, '丁': 0, '戊': 0, '己': 0, '庚': 0, '辛': 0, '壬': 0 },
  
  // 丑土：己土60%, 癸水30%, 辛金10%
  '丑': { '己': 0.6, '癸': 0.3, '辛': 0.1, '甲': 0, '乙': 0, '丙': 0, '丁': 0, '戊': 0, '庚': 0, '壬': 0 },
  
  // 寅木：甲木60%, 丙火30%, 戊土10%
  '寅': { '甲': 0.6, '丙': 0.3, '戊': 0.1, '乙': 0, '丁': 0, '己': 0, '庚': 0, '辛': 0, '壬': 0, '癸': 0 },
  
  // 卯木：乙木100%
  '卯': { '乙': 1.0, '甲': 0, '丙': 0, '丁': 0, '戊': 0, '己': 0, '庚': 0, '辛': 0, '壬': 0, '癸': 0 },
  
  // 辰土：戊土50%, 乙木30%, 癸水20%
  '辰': { '戊': 0.5, '乙': 0.3, '癸': 0.2, '甲': 0, '丙': 0, '丁': 0, '己': 0, '庚': 0, '辛': 0, '壬': 0 },
  
  // 巳火：丙火60%, 庚金30%, 戊土10%
  '巳': { '丙': 0.6, '庚': 0.3, '戊': 0.1, '甲': 0, '乙': 0, '丁': 0, '己': 0, '辛': 0, '壬': 0, '癸': 0 },
  
  // 午火：丁火60%, 己土40%
  '午': { '丁': 0.6, '己': 0.4, '甲': 0, '乙': 0, '丙': 0, '戊': 0, '庚': 0, '辛': 0, '壬': 0, '癸': 0 },
  
  // 未土：己土50%, 丁火30%, 乙木20%
  '未': { '己': 0.5, '丁': 0.3, '乙': 0.2, '甲': 0, '丙': 0, '戊': 0, '庚': 0, '辛': 0, '壬': 0, '癸': 0 },
  
  // 申金：庚金60%, 壬水30%, 戊土10%
  '申': { '庚': 0.6, '壬': 0.3, '戊': 0.1, '甲': 0, '乙': 0, '丙': 0, '丁': 0, '己': 0, '辛': 0, '癸': 0 },
  
  // 酉金：辛金100%
  '酉': { '辛': 1.0, '甲': 0, '乙': 0, '丙': 0, '丁': 0, '戊': 0, '己': 0, '庚': 0, '壬': 0, '癸': 0 },
  
  // 戌土：戊土60%, 辛金30%, 丁火10%
  '戌': { '戊': 0.6, '辛': 0.3, '丁': 0.1, '甲': 0, '乙': 0, '丙': 0, '己': 0, '庚': 0, '壬': 0, '癸': 0 },
  
  // 亥水：壬水60%, 甲木40%
  '亥': { '壬': 0.6, '甲': 0.4, '乙': 0, '丙': 0, '丁': 0, '戊': 0, '己': 0, '庚': 0, '辛': 0, '癸': 0 }
};

/**
 * 获取地支藏干的五行向量
 * @param zhi 地支
 * @returns 五行向量，表示藏干的五行分布
 */
export function getHiddenGanFiveElements(zhi: DiZhi): FiveElementVector {
  const result: FiveElementVector = {
    wood: 0, fire: 0, earth: 0, metal: 0, water: 0
  };
  
  // 获取该地支的藏干映射
  const hiddenGans = diZhiHiddenGan[zhi];
  
  // 遍历所有天干，累加对应五行的权重
  Object.entries(hiddenGans).forEach(([gan, weight]) => {
    if (weight > 0) {
      const element = tianGanElement[gan as TianGan];
      result[element] += weight;
    }
  });
  
  return result;
} 